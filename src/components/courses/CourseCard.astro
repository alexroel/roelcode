---
import Button from "../utils/Button.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import type { UdemyCourse } from "../../data/udemy-courses";

export interface Props {
  course: UdemyCourse;
}

const { course } = Astro.props;
---

<div
  class="course-card bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1 h-full flex flex-col"
>
  <div class="relative">
    <Image
      src={course.image}
      alt={course.title}
      class="w-full h-48 object-cover"
    />

    <!-- Badges -->
    <div class="absolute top-4 left-4 flex gap-2">
      {
        course.popular && (
          <span class="bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-medium shadow-lg">
            <Icon name="star" class="w-3 h-3 inline mr-1" />
            Popular
          </span>
        )
      }
      {
        course.newCourse && (
          <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-medium shadow-lg">
            <Icon name="check" class="w-3 h-3 inline mr-1" />
            Nuevo
          </span>
        )
      }
    </div>

    <!-- Rating overlay -->
    <div
      class="absolute top-4 right-4 bg-black/70 text-white px-2 py-1 rounded-lg text-sm"
    >
      <Icon name="star" class="w-3 h-3 inline text-yellow-400 mr-1" />
      {course.rating.toFixed(1)}
    </div>
  </div>

  <div class="p-6 flex-1 flex flex-col">
    <!-- Title and Description -->
    <h3
      class="text-xl font-bold text-gray-900 dark:text-white mb-2 line-clamp-2"
    >
      {course.title}
    </h3>
    <p class="text-gray-600 dark:text-gray-400 mb-4 line-clamp-3 flex-1">
      {course.headline}
    </p>

    <div class="flex justify-between">
      <!-- Rating and Reviews -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="flex items-center">
            {
              Array.from({ length: 5 }, (_, i) => (
                <Icon
                  name={i < Math.floor(course.rating) ? "star" : "star-half"}
                  class="w-4 h-4 text-yellow-400"
                />
              ))
            }
          </div>
          <span class="text-sm text-gray-600 dark:text-gray-400">
            ({course.numReviews.toLocaleString()})
          </span>
        </div>
      </div>

      <!-- Course Info -->
      <div
        class="flex items-center justify-between mb-4 text-sm text-gray-500 dark:text-gray-400"
      >
        <div class="flex items-center gap-4">
          <span class="flex items-center gap-1">
            <Icon name="courses" class="w-4 h-4" />
            {course.numClass} clases
          </span>
          <span class="flex items-center gap-1">
            <Icon name="instructor" class="w-4 h-4" />
            {course.hours}h
          </span>
        </div>
      </div>
    </div>

    <!-- Price and CTA -->
    <div class="flex items-center justify-between mt-auto">
      <div class="flex items-center gap-2">
        {
          course.priceDiscount && (
            <span class="text-2xl font-bold text-green-600 dark:text-green-400">
              ${course.priceDiscount}
            </span>
          )
        }
        <span
          class={`${course.priceDiscount ? "line-through text-gray-500 text-lg" : "text-2xl font-bold text-gray-900 dark:text-white"}`}
        >
          ${course.price}
        </span>
      </div>
      <Button
        variant="primary"
        size="sm"
        href={course.url}
        target="_blank"
        class="course-cta-btn"
      >
        <Icon name="udemy" slot="icon" class="w-4 h-4" />
        Ver Curso
      </Button>
    </div>
  </div>
</div>

<style>
  .course-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .course-card:hover {
    transform: translateY(-4px);
    box-shadow:
      0 20px 25px -5px rgba(0, 0, 0, 0.1),
      0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .course-cta-btn {
    transition: all 0.2s ease;
  }

  .course-card:hover .course-cta-btn {
    transform: scale(1.05);
  }

  @media (max-width: 768px) {
    .course-card {
      margin-bottom: 1rem;
    }
  }
</style>
